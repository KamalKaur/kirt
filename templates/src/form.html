 {% load staticfiles %}
<html>
  <head>
    <meta charset="utf-8">
    <title>Form</title>


    
<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/themes/smoothness/jquery-ui.css">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/jquery-ui.min.js"></script>
<script src="http://code.jquery.com/ui/1.11.1/jquery-ui.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/autosave.js"></script> 
<script language="javascript" type="text/javascript">
      
      //On clicking advance, for popup

//$(function(){
  //$('.js-popup-link').click(function(e){
   // e.preventDefault();
  //  $("#popup").dialog({modal: true}).dialog('open').load(this.href);
 // })
//})
// The function below is not chainable

function popitup(url) {

// Dialog box opened only once before the following 4 lines
// Now refreshes the page sometimes? 
 
$("#dialog-form").dialog({ modal: true, resizable: false, autoOpen: false,closeOnEscape: true,
 width: 515, height: 245 });
  $.ajax({
    url: url,
    success: function(data) {
    $("#dialog-form").html(data).dialog('open');
  
    }

  });
$('#dialog-form').bind('dialogclose', function() {
    var split = url.split("="); //URL has a pattern, splitted it from =.
    //alert(url);
    var idyear = split[1]; //After splitting from =, there is a pattern which is splitted from &
    //alert(idyear);
    var yearmonth = split[2]; 
    //alert(yearmonth);
    var month = split[3];
    //alert(month);
    var worker_id = idyear.split("&")[0];
    //alert(worker_id);
    var year = yearmonth.split("&")[0];
    //alert(year);
    request_url = "/return_advance/?worker_id=" + worker_id + "&month=" + month + "&year=" + year;
     $.ajax({
    url: request_url,
    success: function(data) { 
    $('#advance_'+ worker_id).attr("value", data);   
    }

  });

 });
return false;

  }

  //return false;
  
//}

      //function popitup(url) {
      //newwindow=window.open(url,'Add Advance','height=400, width=450');
     // if (window.focus) {newwindow.focus()}
     // return false;
     // }
    </script>
<script>
$(document).ready(function(){
if ({{editable}} == '0')
$(".details :input").attr('readonly', true);

else
$(".details :input").attr('readonly', false);
})
</script>
<link rel="stylesheet" href="{{ STATIC_URL }}css/form.css">
  </head>

  <body>
  <div class="header">
  <table>
    <tr> 
        <th class="setwidth1">&nbsp; Name </th>
        <th class="setwidth"> Days </th>
        <th class="setwidth"> OT </th>
        <th class="setwidth"> Paid </th>
        <th class="setwidth"> Advance </th> 
        </div>
      </tr>
  </table> 
  </div>	
    <form class="details" action="" method="">
      {% csrf_token %}
      {% for value in detail_list %}

        <div class="left">
          {{value.worker_id}} <a href="/particulars/?worker_id={{value.worker_id}}&month={{month}}&year={{year}}"> {{value.first_name}}</a>
          <select id="{{value.worker_id}}" class="worker"> <option 
            value="{{value.worker_id}}"> {{value.first_name}}</option> </select>
        
          <div class="right">
            <input type="text" id="days_{{value.worker_id}}" 
              placeholder="Days" class="days" value="{{value.attendance}}">
            <input type="text" id="overtime_{{value.worker_id}}" 
              placeholder="Overtime" class="overtime" value="{{value.overtime}}"> 
            <input type="text" id="paid_{{value.worker_id}}" 
              placeholder="Paid Amount" class="paid" value="{{value.paid_salary}}"> 
            <input type="text" id="advance_{{value.worker_id}}" 
              placeholder="Advance" class="advance" value = "{{value.advance_amount}}">
            {% if editable == 1 %}
            <a href="" onclick="return popitup('/popupadvance/?worker_id={{value.worker_id}}&year={{year}}&month={{month}}')">Advance </a>
<div id="dialog-form"></div>	
            <br /><br /><br /><br /><br /><br />
            {% endif %}
          </div>
        </div>
      {% endfor %} 
    </form> 

<div class="search">
<form method="POST" action="">
{% csrf_token %}
{{search}}
{{editable}}
<input class="hiddensubmit" type="submit" value="submit" action="">
</form>


</div>


  </body>

</html>
